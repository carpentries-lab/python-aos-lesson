<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Python for Atmosphere and Ocean Scientists: Defensive programming</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav carpentries"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="cp-logo" alt="The Carpentries" src="assets/images/carpentries-logo.svg"></div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/08-defensive.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav carpentries" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="The Carpentries" src="assets/images/carpentries-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Python for Atmosphere and Ocean Scientists
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Python for Atmosphere and Ocean Scientists
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Glossary</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Python for Atmosphere and Ocean Scientists
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 69%" class="percentage">
    69%
  </div>
  <div class="progress carpentries">
    <div class="progress-bar carpentries" role="progressbar" style="width: 69%" aria-valuenow="69" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/08-defensive.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-conda.html">1. Package management</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-visualisation.html">2. Data processing and visualisation</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-functions.html">3. Functions</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-cmdline.html">4. Command line programs</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-git.html">5. Version control</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-github.html">6. GitHub</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-vectorisation.html">7. Vectorisation</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        8. Defensive programming
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#types-of-errors">Types of errors</a></li>
<li><a href="#raising-errors">Raising errors</a></li>
<li><a href="#handling-errors">Handling errors</a></li>
<li><a href="#assertions">Assertions</a></li>
<li><a href="#logging">Logging</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="09-provenance.html">9. Data provenance</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="10-large-data.html">10. Large data</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Glossary</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="07-vectorisation.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="09-provenance.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="07-vectorisation.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Vectorisation
        </a>
        <a class="chapter-link float-end" href="09-provenance.html" rel="next">
          Next: Data provenance...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Defensive programming</h1>
        <p>Last updated on 2024-07-25 |

        <a href="https://github.com/fishtree-attempt/python-aos-lesson/edit/main/episodes/08-defensive.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can I make my programs more reliable?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Signal errors by raising exceptions.</li>
<li>Use try-except blocks to catch and handle exceptions.</li>
<li>Explain what an assertion is.</li>
<li>Add assertions that check the program’s state is correct.</li>
<li>Use a logging framework to report on program activity.</li>
<li>Identify sources of more advanced lessons on code testing.</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="scientists-nightmare" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="scientists-nightmare" class="callout-inner">
<h3 class="callout-title">Scientist’s nightmare<a class="anchor" aria-label="anchor" href="#scientists-nightmare"></a>
</h3>
<div class="callout-content">
<p>If you needed any motivation to learn and employ the principles of
defensive programming, look no further than <a href="https://science.sciencemag.org/content/314/5807/1856" class="external-link">this
article</a>. It documents the experience of a researcher who had to
retract five published papers - three of which were in <em>Science</em>
- because his code had inadvertently switched the rows and columns of a
data table.</p>
</div>
</div>
</div>
<p>Now that we’ve written
<code>plot_precipitation_climatology.py</code>, how can we be sure that
it’s producing reliable results?</p>
<p>The first step toward getting the right answers from our programs is
to assume that mistakes <em>will</em> happen and to guard against them.
This is called defensive programming, and there are a number of tools
and approaches at our disposal for doing this. Broadly speaking, we can
raise and handle errors to check and respond to program inputs, use
assertions to make sure nothing crazy or unexpected has happened, write
unit tests to make sure each component of our program produces expected
outputs, and use a logging framework to report on program activity. In
this lesson, we’ll look at how error handling, assertions and logging
can make the unit conversion in our program more reliable, and we’ll
provide links to further information on unit .</p>
<section><h2 class="section-heading" id="types-of-errors">Types of errors<a class="anchor" aria-label="anchor" href="#types-of-errors"></a>
<a class="anchor" aria-label="anchor" href="#types-of-errors"></a></h2>
<hr class="half-width"><p>There are essentially two kinds of errors that can arise in Python:
<em>syntax errors</em> and <em>exceptions</em>. You’re probably familiar
with the former:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>rainfall <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="cf">if</span> rainfall <span class="op">&gt;</span> <span class="dv">10</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"heavy rainfall"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>    if rainfall &gt; 10
                    ^
SyntaxError: expected ':'</code></pre>
</div>
<p>Once a statement or expression is syntactically correct, it may cause
an error when an attempt is made to execute it. Errors detected during
execution are called exceptions (i.e. an exception from normal
behaviour) and there are lots of different types of exceptions:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="dv">10</span> <span class="op">*</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">0</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>ZeroDivisionError: division by zero</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="dv">4</span> <span class="op">+</span> spam<span class="op">*</span><span class="dv">3</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>NameError: name 'spam' is not defined</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">"2"</span> <span class="op">+</span> <span class="dv">2</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>TypeError: can only concatenate str (not "int") to str</code></pre>
</div>
</section><section><h2 class="section-heading" id="raising-errors">Raising errors<a class="anchor" aria-label="anchor" href="#raising-errors"></a>
<a class="anchor" aria-label="anchor" href="#raising-errors"></a></h2>
<hr class="half-width"><p>With respect to defensive programming, it can sometimes be useful to
raise your own exceptions (using the <code>raise</code> keyword).</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>infile <span class="op">=</span> <span class="st">"temperature_data.txt"</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>file_format <span class="op">=</span> infile.split(<span class="st">"."</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="cf">if</span> file_format <span class="op">!=</span> <span class="st">"nc"</span>:</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"</span><span class="sc">{</span>infile<span class="sc">}</span><span class="ss"> does not have the netCDF file extension .nc"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>ValueError                                Traceback (most recent call last)
/var/folders/6v/vrpsky6j509dff7250jyg8240000gp/T/ipykernel_12425/3612736507.py in &lt;module&gt;
      2 file_format = infile.split(".")[-1]
      3 if file_format != "nc":
----&gt; 4     raise ValueError(f"{infile} does not have the netCDF file extension .nc")

ValueError: temperature_data.txt does not have the netCDF file extension .nc</code></pre>
</div>
<p>In this case we’ve chosen to raise a <code>ValueError</code>, but we
could pick any of the <a href="https://docs.python.org/3/library/exceptions.html#exception-hierarchy" class="external-link">builtin
exception types</a> (including just a generic <code>Exception</code>) or
define our own <a href="https://towardsdatascience.com/how-to-define-custom-exception-classes-in-python-bfa346629bca" class="external-link">custom
exception class</a>.</p>
<p>In the context of our <code>plot_precipitation_climatology.py</code>
script, we currently multiply our data by 86400 regardless of what the
input units are. It would be better if we modified the <code>main</code>
function so that the program multiplied by 86400 if the input units are
kg m-2 s-1, performed no unit conversion if the input units are mm/day,
or halted with an informative error message if the input data have some
other units.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>input_units <span class="op">=</span> clim.attrs[<span class="st">"units"</span>]</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="cf">if</span> input_units <span class="op">==</span> <span class="st">"kg m-2 s-1"</span>:</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    clim <span class="op">=</span> convert_pr_units(clim)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="cf">elif</span> input_units <span class="op">==</span> <span class="st">"mm/day"</span>:</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"""Input units are not 'kg m-2 s-1' or 'mm/day'"""</span>)</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="handling-errors">Handling errors<a class="anchor" aria-label="anchor" href="#handling-errors"></a>
<a class="anchor" aria-label="anchor" href="#handling-errors"></a></h2>
<hr class="half-width"><p>As we’ve seen in the examples above, if exceptions aren’t dealt with
the program crashes. The error message upon crashing is sometimes be
easy to understand (particularly if you wrote the <code>raise</code>
statement yourself) but can often be cryptic.</p>
<p>If we’d rather the program didn’t crash when a particular exception
occurs, we can use a try-except block to catch and handle the exception.
The syntax of the try-except block is:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>    <span class="op">&lt;</span>do something<span class="op">&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    <span class="op">&lt;</span>handle the error<span class="op">&gt;</span></span></code></pre>
</div>
<p>The code in the except block is only executed if an exception
occurred in the try block. The except block is required with a try
block, even if it contains only the <code>pass</code> statement
(i.e. ignore the exception and carry on). For example, let’s say there’s
a calculation in our program where we need to divide by the number of
available weather stations. If there were no weather stations available,
by default the program would crash.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>quantity <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>n_stations <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>scaled_quantity <span class="op">=</span> quantity <span class="op">/</span> n_stations</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="bu">print</span>(scaled_quantity)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>ZeroDivisionError                         Traceback (most recent call last)
/var/folders/6v/vrpsky6j509dff7250jyg8240000gp/T/ipykernel_12425/3927438267.py in &lt;module&gt;
      2 n_stations = 0
      3
----&gt; 4 scaled_quantity = quantity / n_stations
      5 print(scaled_quantity)

ZeroDivisionError: division by zero</code></pre>
</div>
<p>If we’d prefer the program simply continue with a
<code>scaled_quantity</code> value of NaN, we could catch and handle the
<code>ZeroDivisionError</code>.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>quantity <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>n_stations <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>    scaled_quantity <span class="op">=</span> quantity <span class="op">/</span> n_stations</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ZeroDivisionError</span>:</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>    scaled_quantity <span class="op">=</span> np.nan</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="bu">print</span>(scaled_quantity)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">nan</span></span></code></pre>
</div>
<p>In the context of our <code>plot_precipitation_climatology.py</code>
script, the variable attributes from the input netCDF file are stored in
a dictionary that we access via <code>clim.attrs</code>. The dictionary
keys are the names of the variable attributes
(e.g. <code>standard_name</code>, <code>long_name</code>,
<code>units</code>) and the dictionary values are the values
corresponding to those keys (e.g. <code>precipitation_flux</code>,
<code>Precipitation</code>, <code>kg m-2 s-1</code>). If the input data
file didn’t have a units attribute associated with the precipitation
variable, our program would currently fail with a <code>KeyError</code>
(which Python raises when you ask for a key that isn’t in a
dictionary).</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>example_dict <span class="op">=</span> {</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>    <span class="st">"standard_name"</span>: <span class="st">"precipitation_flux"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>    <span class="st">"long_name"</span>: <span class="st">"Precipitation"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>}</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>units <span class="op">=</span> example_dict[<span class="st">"units"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>KeyError                                  Traceback (most recent call last)
/var/folders/6v/vrpsky6j509dff7250jyg8240000gp/T/ipykernel_12425/2679443625.py in &lt;module&gt;
      1 example_dict = {
      2     "standard_name": "precipitation_flux",
      3     "long_name": "Precipitation",
      4 }
----&gt; 5 units = example_dict["units"]

KeyError: 'units'</code></pre>
</div>
<p>It’s fine that our program would crash in this situation (we can’t
continue if we don’t know the units of the input data), but the error
message doesn’t explicitly tell the user that the input file requires a
units attribute. To make this crystal clear, we could use a try-except
block in the <code>main</code> function to catch the
<code>KeyError</code> and re-define a better error message.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>    input_units <span class="op">=</span> clim.attrs[<span class="st">"units"</span>]</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">KeyError</span>(<span class="ss">f"Precipitation variable in </span><span class="sc">{</span>inargs<span class="sc">.</span>pr_file<span class="sc">}</span><span class="ss"> does not have a units attribute"</span>)</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="assertions">Assertions<a class="anchor" aria-label="anchor" href="#assertions"></a>
<a class="anchor" aria-label="anchor" href="#assertions"></a></h2>
<hr class="half-width"><p>Unexpected behaviour in a program can sometimes propagate a long way
before triggering an exception or producing a perplexing result. For
instance, if a calculation produces a non-physical value for
precipitation (e.g. a negative value) that value could be used in
various downstream calculations of drought and fire risk (combined with
values for temperature, wind, humidity, etc). The final plot of the
forest fire danger index might look wrong (or not, which would be even
worse) to the scientist who wrote and executed the code, but it wouldn’t
be immediately obvious that the precipitation calculation was the source
of the problem.</p>
<p>In order to avoid propagation, it’s best to nip unexpected behaviour
in the bud right when it occurs. One way to do this is to add assertions
to your code. An assertion is simply a statement that something must be
true at a certain point in a program. When Python sees one, it evaluates
the assertion’s condition. If it’s true, Python does nothing, but if
it’s false, Python halts the program immediately and raises an
<code>AssertionError</code> with a custom error message.</p>
<p>To demonstrate an assertion in action, consider this piece of code
that halts if any precipitation data is negative:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>pr_data <span class="op">=</span> np.array([<span class="fl">1.5</span>, <span class="fl">2.3</span>, <span class="fl">0.7</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="fl">4.4</span>])</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="cf">assert</span> pr_data.<span class="bu">min</span>() <span class="op">&gt;=</span> <span class="fl">0.0</span>, <span class="st">"There is at least one negative precipitation value"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
&lt;ipython-input-19-33d87ea29ae4&gt; in &lt;module&gt;()
----&gt; 1 assert pr_data.min() &gt;= 0.0, "There is at least one negative precipitation value"

AssertionError: There is at least one negative precipitation value</code></pre>
</div>
<p>With respect to our command line program, one thing to check would be
that the climatological precipitation values lie within a sensible range
after the unit conversion. The <a href="https://wmo.asu.edu/content/world-greatest-twenty-four-hour-1-day-rainfall" class="external-link">world
record highest daily rainfall total</a> is 1825mm (at Reunion Island in
1966), so climatological values across the globe should be more than 0
but less than 2000 mm/day. We could add the following assertions to our
<code>convert_pr_units</code> function to catch unexpected precipitation
values.</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="cf">assert</span> darray.data.<span class="bu">min</span>() <span class="op">&gt;=</span> <span class="fl">0.0</span>, <span class="st">"There is at least one negative precipitation value"</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="cf">assert</span> darray.data.<span class="bu">max</span>() <span class="op">&lt;</span> <span class="dv">2000</span>, <span class="st">"There is a precipitation value/s &gt; 2000 mm/day"</span></span></code></pre>
</div>
<p>Assertions are also used in unit testing (each test culminates in an
assertion), but that topic is beyond the scope of this lesson.</p>
<div id="testing-and-continuous-integration" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="testing-and-continuous-integration" class="callout-inner">
<h3 class="callout-title">Testing and continuous integration<a class="anchor" aria-label="anchor" href="#testing-and-continuous-integration"></a>
</h3>
<div class="callout-content">
<p>An assertion checks that something is true at a particular point in
the program. For programs that are more complex (or research critical)
than <code>plot_precipitation_climatology.py</code>, it’s a good idea to
take the next step and check the overall behavior of entire pieces (or
units) of code. Related concepts like unit testing and continuous
integration are beyond the scope of this lesson, but <em>Research
Software Engineering With Python</em> has a <a href="https://third-bit.com/py-rse/testing.html" class="external-link">chapter on testing</a>
that is well worth a read.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="logging">Logging<a class="anchor" aria-label="anchor" href="#logging"></a>
<a class="anchor" aria-label="anchor" href="#logging"></a></h2>
<hr class="half-width"><p>So far we’ve considered how to make our programs halt or handle the
situation when things go wrong. Another option in our defensive
programming toolkit is to have our programs report their own
activity.</p>
<p>For example, let’s say we’re working with relative humidity data. We
wouldn’t typically expect to encounter any values over 100%, but it is
physically possible. Rather than halt the program if a value over 100%
occurs, we might therefore want our program to simply report the maximum
relative humidity. We can then decide whether to trust the output or not
(e.g. a value of 100.1% might be ok but not 150%).</p>
<p>To do this reporting, our first instinct might be to add a
<code>print</code> statement to the program.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>rh_data <span class="op">=</span> np.array([<span class="fl">1.5</span>, <span class="fl">20.4</span>, <span class="fl">100.1</span>, <span class="fl">76.3</span>, <span class="fl">54.4</span>])</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>rh_max <span class="op">=</span> rh_data.<span class="bu">max</span>()</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The maximum relative humidity was </span><span class="sc">{</span>rh_max<span class="sc">}</span><span class="ss">%"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The maximum relative humidity was 100.1%</code></pre>
</div>
<p>The problem with this approach is that information printed to the
screen is lost once we close our command line session. Constantly
adding, removing or commenting out <code>print</code> statements is also
tedious and error-prone.</p>
<p>A better approach is to use a logging framework, such as Python’s
<code>logging</code> library. This lets us leave debugging statements in
our code and turn them on or off at will. Let’s start by replacing our
<code>print</code> statement with a <code>logging</code> command.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>rh_data <span class="op">=</span> np.array([<span class="fl">1.5</span>, <span class="fl">20.4</span>, <span class="fl">100.1</span>, <span class="fl">76.3</span>, <span class="fl">54.4</span>])</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>rh_max <span class="op">=</span> rh_data.<span class="bu">max</span>()</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>logging.debug(<span class="ss">f"The maximum relative humidity was </span><span class="sc">{</span>rh_max<span class="sc">}</span><span class="ss">%"</span>)</span></code></pre>
</div>
<p>Whoops! There’s no output because by default the logging library only
reports information at the “warning” level and above. In order of
increasing severity, the available levels are:</p>
<ul><li>
<code>debug</code>: very detailed information used for localizing
errors.</li>
<li>
<code>info</code>: confirmation that things are working as
expected.</li>
<li>
<code>warning</code>: something unexpected happened, but the program
will keep going.</li>
<li>
<code>error</code>: something has gone badly wrong, but the program
hasn’t hurt anything.</li>
<li>
<code>critical</code>: potential loss of data, security breach,
etc.</li>
</ul><p>If we want to see the output from less severe levels (i.e. turn our
debugging statements on), we’d need to change the minimum level in the
logging configuration. We can also provide the name of a file to write
the logging information to, so that it isn’t lost when we finish our
command line session.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># for loop only required in notebooks</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="cf">for</span> handler <span class="kw">in</span> logging.root.handlers[:]:</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>    logging.root.removeHandler(handler)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>    </span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>logging.DEBUG, filename<span class="op">=</span><span class="st">"log.txt"</span>)) </span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>rh_data <span class="op">=</span> np.array([<span class="fl">1.5</span>, <span class="fl">20.4</span>, <span class="fl">100.1</span>, <span class="fl">76.3</span>, <span class="fl">54.4</span>])</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>rh_max <span class="op">=</span> rh_data.<span class="bu">max</span>()</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>logging.debug(<span class="ss">f"The maximum relative humidity was </span><span class="sc">{</span>rh_max<span class="sc">}</span><span class="ss">%"</span>)</span></code></pre>
</div>
<p>(The for loop is needed to turn off the background logging the
notebook does itself. It’s not needed in a Python script.)</p>
<p>Notice that we’ve used capital <code>logging.DEBUG</code> (which is
an integer value) to set the logging level, as opposed to the
<code>logging.debug</code> function that is used for logging a
message.</p>
<p>By setting the logging level to “DEBUG”, our output “log.txt” file
will now capture all logging information with a flag of ‘debug’ or
higher - that is, all logging outputs will be written to our log
file.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">$</span> cat log.txt</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>DEBUG:root:The maximum relative humidity was 100.1%</code></pre>
</div>
<p>In the context of the <code>plot_precipitation_climatology.py</code>
script, it would be nice to know whether or not unit conversion was
performed. To do this we just need a few small changes to the script. We
need to import the logging library at the top of the script,</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="im">import</span> logging</span></code></pre>
</div>
<p>and set the logging configuration and add a <code>logging.info</code>
command in the <code>main</code> function.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="kw">def</span> main(inargs):</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>    <span class="co">"""Run the program."""</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>    </span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>    logging.basicConfig(level<span class="op">=</span>logging.DEBUG, filename<span class="op">=</span><span class="st">"log.txt"</span>) </span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>    </span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>    ...</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>    </span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>    <span class="cf">if</span> input_units <span class="op">==</span> <span class="st">'kg m-2 s-1'</span>:</span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>        clim <span class="op">=</span> convert_pr_units(clim)</span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>        logging.info(<span class="st">"Units converted from kg m-2 s-1 to mm/day"</span>)</span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>    <span class="cf">elif</span> input_units <span class="op">==</span> <span class="st">"mm/day"</span>:</span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"""Input units are not 'kg m-2 s-1' or 'mm/day'"""</span>)</span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>    </span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a>    ...</span></code></pre>
</div>
<div id="update-your-script" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="update-your-script" class="callout-inner">
<h3 class="callout-title">Update your script<a class="anchor" aria-label="anchor" href="#update-your-script"></a>
</h3>
<div class="callout-content">
<p>Update your working copy of
<code>plot_precipitation_climatology.py</code> with the changes from
this lesson.</p>
<p>This will mean your <code>main</code> function will now read as
follows,</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="kw">def</span> main(inargs):</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>    <span class="co">"""Run the program."""</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>    logging.basicConfig(level<span class="op">=</span>logging.DEBUG, filename<span class="op">=</span><span class="st">"log.txt"</span>) </span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>    ds <span class="op">=</span> xr.open_dataset(inargs.pr_file)</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>   </span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>    clim <span class="op">=</span> ds[<span class="st">"pr"</span>].groupby(<span class="st">"time.season"</span>).mean(<span class="st">"time"</span>, keep_attrs<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>        input_units <span class="op">=</span> clim.attrs[<span class="st">"units"</span>]</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">KeyError</span>(<span class="ss">f"Precipitation variable in </span><span class="sc">{</span>inargs<span class="sc">.</span>pr_file<span class="sc">}</span><span class="ss"> must have a units attribute"</span>)</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>    <span class="cf">if</span> input_units <span class="op">==</span> <span class="st">"kg m-2 s-1"</span>:</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>        clim <span class="op">=</span> convert_pr_units(clim)</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a>        logging.info(<span class="st">"Units converted from kg m-2 s-1 to mm/day"</span>)</span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a>    <span class="cf">elif</span> input_units <span class="op">==</span> <span class="st">"mm/day"</span>:</span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"""Input units are not 'kg m-2 s-1' or 'mm/day'"""</span>)</span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a>    <span class="cf">if</span> inargs.mask:</span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a>        sftlf_file, realm <span class="op">=</span> inargs.mask</span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a>        clim <span class="op">=</span> apply_mask(clim, sftlf_file, realm)</span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a>    create_plot(</span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a>        clim,</span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a>        dset.attrs[<span class="st">"source_id"</span>],</span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a>        inargs.season,</span>
<span id="cb31-31"><a href="#cb31-31" tabindex="-1"></a>        gridlines<span class="op">=</span>inargs.gridlines,</span>
<span id="cb31-32"><a href="#cb31-32" tabindex="-1"></a>        levels<span class="op">=</span>inargs.cbar_levels</span>
<span id="cb31-33"><a href="#cb31-33" tabindex="-1"></a>    )    </span>
<span id="cb31-34"><a href="#cb31-34" tabindex="-1"></a>    plt.savefig(</span>
<span id="cb31-35"><a href="#cb31-35" tabindex="-1"></a>        inargs.output_file,</span>
<span id="cb31-36"><a href="#cb31-36" tabindex="-1"></a>        dpi<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb31-37"><a href="#cb31-37" tabindex="-1"></a>        bbox_inches<span class="op">=</span><span class="st">"tight"</span>,</span>
<span id="cb31-38"><a href="#cb31-38" tabindex="-1"></a>        facecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb31-39"><a href="#cb31-39" tabindex="-1"></a>    )</span></code></pre>
</div>
<p>and your <code>convert_pr_units</code> as:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="kw">def</span> convert_pr_units(da):</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>    <span class="co">"""Convert kg m-2 s-1 to mm day-1.</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="co">   </span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="co">      da (xarray.DataArray): Precipitation data</span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>    </span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>    da.data <span class="op">=</span> da.data <span class="op">*</span> <span class="dv">86400</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>    da.attrs[<span class="st">"units"</span>] <span class="op">=</span> <span class="st">"mm/day"</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>   </span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>    <span class="cf">assert</span> da.data.<span class="bu">min</span>() <span class="op">&gt;=</span> <span class="fl">0.0</span>, <span class="st">"There is at least one negative precipitation value"</span></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>    <span class="cf">assert</span> da.data.<span class="bu">max</span>() <span class="op">&lt;</span> <span class="dv">2000</span>, <span class="st">"There is a precipitation value/s &gt; 2000 mm/day"</span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a>    </span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a>    <span class="cf">return</span> da</span></code></pre>
</div>
</div>
</div>
</div>
<div id="verbose-reporting" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="verbose-reporting" class="callout-inner">
<h3 class="callout-title">Verbose reporting<a class="anchor" aria-label="anchor" href="#verbose-reporting"></a>
</h3>
<div class="callout-content">
<p>Add two new command line options to
<code>plot_precipitation_climatology.py</code>.</p>
<p>The first should change the logging level so reporting from the
program is more verbose.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>parser.add_argument(</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>    <span class="st">"-v"</span>,</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>    <span class="st">"--verbose"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>    action<span class="op">=</span><span class="st">"store_true"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>    default<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>    <span class="bu">help</span><span class="op">=</span><span class="st">"Change the minimum logging reporting level from WARNING (default) to INFO"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>)</span></code></pre>
</div>
<p>The second should allow the user to specify the name of the log file.
(If they don’t specify a name then the logging information is printed to
the screen.)</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>parser.add_argument(</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>    <span class="st">"--logfile"</span>,</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>    <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>,</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>    default<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>    <span class="bu">help</span><span class="op">=</span><span class="st">"Name of log file (by default logging information is printed to the screen)"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The basic configuration command at the top of the <code>main</code>
function
(<code>logging.basicConfig(level=logging.DEBUG, filename="log.txt")</code>)
needs to be replaced with the following:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>log_lev <span class="op">=</span> logging.INFO <span class="cf">if</span> inargs.verbose <span class="cf">else</span> logging.WARNING</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>logging.basicConfig(level<span class="op">=</span>log_lev, filename<span class="op">=</span>inargs.logfile) </span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="error-handling-for-landocean-masks" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="error-handling-for-landocean-masks" class="callout-inner">
<h3 class="callout-title">Error handling for land/ocean masks<a class="anchor" aria-label="anchor" href="#error-handling-for-landocean-masks"></a>
</h3>
<div class="callout-content">
<p>In the previous lesson we added an <code>apply_mask</code> function
to our script. Update the following if statement in that function so
that it raises a <code>ValueError</code> if the realm is not
<code>ocean</code> or <code>land</code>.</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="cf">if</span> realm <span class="op">==</span> <span class="st">"land"</span>:</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>    masked_da <span class="op">=</span> da.where(ds[<span class="st">"sftlf"</span>].data <span class="op">&lt;</span> <span class="dv">50</span>)</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>    masked_da <span class="op">=</span> da.where(ds[<span class="st">"sftlf"</span>].data <span class="op">&gt;</span> <span class="dv">50</span>)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="cf">if</span> realm.lower() <span class="op">==</span> <span class="st">'land'</span>:</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>    masked_da <span class="op">=</span> da.where(ds[<span class="st">"sftlf"</span>].data <span class="op">&lt;</span> <span class="dv">50</span>)</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="cf">elif</span> realm.lower() <span class="op">==</span> <span class="st">'ocean'</span>:</span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>    masked_da <span class="op">=</span> da.where(ds[<span class="st">"sftlf"</span>].data <span class="op">&gt;</span> <span class="dv">50</span>)</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"""Mask realm is not 'ocean' or 'land'"""</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="plot_precipitation_climatology.py" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="plot_precipitation_climatology.py" class="callout-inner">
<h3 class="callout-title">plot_precipitation_climatology.py<a class="anchor" aria-label="anchor" href="#plot_precipitation_climatology.py"></a>
</h3>
<div class="callout-content">
<p>At the conclusion of this lesson your
<code>plot_precipitation_climatology.py</code> script should look
something like the following:</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a><span class="im">import</span> cartopy.crs <span class="im">as</span> ccrs</span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a><span class="im">import</span> cmocean</span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a><span class="kw">def</span> convert_pr_units(da):</span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a>    <span class="co">"""Convert kg m-2 s-1 to mm day-1.</span></span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a><span class="co">      da (xarray.DataArray): Precipitation data</span></span>
<span id="cb38-16"><a href="#cb38-16" tabindex="-1"></a><span class="co">   </span></span>
<span id="cb38-17"><a href="#cb38-17" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb38-18"><a href="#cb38-18" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" tabindex="-1"></a>    da.data <span class="op">=</span> da.data <span class="op">*</span> <span class="dv">86400</span></span>
<span id="cb38-20"><a href="#cb38-20" tabindex="-1"></a>    da.attrs[<span class="st">"units"</span>] <span class="op">=</span> <span class="st">"mm/day"</span></span>
<span id="cb38-21"><a href="#cb38-21" tabindex="-1"></a>   </span>
<span id="cb38-22"><a href="#cb38-22" tabindex="-1"></a>    <span class="cf">assert</span> da.data.<span class="bu">min</span>() <span class="op">&gt;=</span> <span class="fl">0.0</span>, <span class="st">"There is at least one negative precipitation value"</span></span>
<span id="cb38-23"><a href="#cb38-23" tabindex="-1"></a>    <span class="cf">assert</span> da.data.<span class="bu">max</span>() <span class="op">&lt;</span> <span class="dv">2000</span>, <span class="st">"There is a precipitation value/s &gt; 2000 mm/day"</span></span>
<span id="cb38-24"><a href="#cb38-24" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" tabindex="-1"></a>    <span class="cf">return</span> da</span>
<span id="cb38-26"><a href="#cb38-26" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" tabindex="-1"></a><span class="kw">def</span> apply_mask(da, sftlf_file, realm):</span>
<span id="cb38-29"><a href="#cb38-29" tabindex="-1"></a>    <span class="co">"""Mask ocean or land using a sftlf (land surface fraction) file.</span></span>
<span id="cb38-30"><a href="#cb38-30" tabindex="-1"></a><span class="co">   </span></span>
<span id="cb38-31"><a href="#cb38-31" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb38-32"><a href="#cb38-32" tabindex="-1"></a><span class="co">      da (xarray.DataArray): Data to mask</span></span>
<span id="cb38-33"><a href="#cb38-33" tabindex="-1"></a><span class="co">      sftlf_file (str): Land surface fraction file</span></span>
<span id="cb38-34"><a href="#cb38-34" tabindex="-1"></a><span class="co">      realm (str): Realm to mask</span></span>
<span id="cb38-35"><a href="#cb38-35" tabindex="-1"></a><span class="co">   </span></span>
<span id="cb38-36"><a href="#cb38-36" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb38-37"><a href="#cb38-37" tabindex="-1"></a>  </span>
<span id="cb38-38"><a href="#cb38-38" tabindex="-1"></a>    ds <span class="op">=</span> xr.open_dataset(sftlf_file)</span>
<span id="cb38-39"><a href="#cb38-39" tabindex="-1"></a>    <span class="cf">if</span> realm.lower() <span class="op">==</span> <span class="st">"land"</span>:</span>
<span id="cb38-40"><a href="#cb38-40" tabindex="-1"></a>        masked_da <span class="op">=</span> da.where(ds[<span class="st">"sftlf"</span>].data <span class="op">&lt;</span> <span class="dv">50</span>)</span>
<span id="cb38-41"><a href="#cb38-41" tabindex="-1"></a>    <span class="cf">elif</span> realm.lower() <span class="op">==</span> <span class="st">'ocean'</span>:</span>
<span id="cb38-42"><a href="#cb38-42" tabindex="-1"></a>        masked_da <span class="op">=</span> da.where(ds[<span class="st">"sftlf"</span>].data <span class="op">&gt;</span> <span class="dv">50</span>)   </span>
<span id="cb38-43"><a href="#cb38-43" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb38-44"><a href="#cb38-44" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"""Mask realm is not 'ocean' or 'land'"""</span>)    </span>
<span id="cb38-45"><a href="#cb38-45" tabindex="-1"></a></span>
<span id="cb38-46"><a href="#cb38-46" tabindex="-1"></a>    <span class="cf">return</span> masked_da</span>
<span id="cb38-47"><a href="#cb38-47" tabindex="-1"></a></span>
<span id="cb38-48"><a href="#cb38-48" tabindex="-1"></a></span>
<span id="cb38-49"><a href="#cb38-49" tabindex="-1"></a><span class="kw">def</span> create_plot(clim, model, season, gridlines<span class="op">=</span><span class="va">False</span>, levels<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb38-50"><a href="#cb38-50" tabindex="-1"></a>    <span class="co">"""Plot the precipitation climatology.</span></span>
<span id="cb38-51"><a href="#cb38-51" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb38-52"><a href="#cb38-52" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb38-53"><a href="#cb38-53" tabindex="-1"></a><span class="co">      clim (xarray.DataArray): Precipitation climatology data</span></span>
<span id="cb38-54"><a href="#cb38-54" tabindex="-1"></a><span class="co">      model (str): Name of the climate model</span></span>
<span id="cb38-55"><a href="#cb38-55" tabindex="-1"></a><span class="co">      season (str): Season</span></span>
<span id="cb38-56"><a href="#cb38-56" tabindex="-1"></a><span class="co">     </span></span>
<span id="cb38-57"><a href="#cb38-57" tabindex="-1"></a><span class="co">    Kwargs:</span></span>
<span id="cb38-58"><a href="#cb38-58" tabindex="-1"></a><span class="co">      gridlines (bool): Select whether to plot gridlines</span></span>
<span id="cb38-59"><a href="#cb38-59" tabindex="-1"></a><span class="co">      levels (list): Tick marks on the colorbar    </span></span>
<span id="cb38-60"><a href="#cb38-60" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb38-61"><a href="#cb38-61" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb38-62"><a href="#cb38-62" tabindex="-1"></a></span>
<span id="cb38-63"><a href="#cb38-63" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> levels:</span>
<span id="cb38-64"><a href="#cb38-64" tabindex="-1"></a>        levels <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="fl">13.5</span>, <span class="fl">1.5</span>)</span>
<span id="cb38-65"><a href="#cb38-65" tabindex="-1"></a>       </span>
<span id="cb38-66"><a href="#cb38-66" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>[<span class="dv">12</span>,<span class="dv">5</span>])</span>
<span id="cb38-67"><a href="#cb38-67" tabindex="-1"></a>    ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>, projection<span class="op">=</span>ccrs.PlateCarree(central_longitude<span class="op">=</span><span class="dv">180</span>))</span>
<span id="cb38-68"><a href="#cb38-68" tabindex="-1"></a>    clim.sel(season<span class="op">=</span>season).plot.contourf(</span>
<span id="cb38-69"><a href="#cb38-69" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb38-70"><a href="#cb38-70" tabindex="-1"></a>        levels<span class="op">=</span>levels,</span>
<span id="cb38-71"><a href="#cb38-71" tabindex="-1"></a>        extend<span class="op">=</span><span class="st">'max'</span>,</span>
<span id="cb38-72"><a href="#cb38-72" tabindex="-1"></a>        transform<span class="op">=</span>ccrs.PlateCarree(),</span>
<span id="cb38-73"><a href="#cb38-73" tabindex="-1"></a>        cbar_kwargs<span class="op">=</span>{<span class="st">"label"</span>: clim.units},</span>
<span id="cb38-74"><a href="#cb38-74" tabindex="-1"></a>        cmap<span class="op">=</span>cmocean.cm.haline_r,</span>
<span id="cb38-75"><a href="#cb38-75" tabindex="-1"></a>    )</span>
<span id="cb38-76"><a href="#cb38-76" tabindex="-1"></a>    ax.coastlines()</span>
<span id="cb38-77"><a href="#cb38-77" tabindex="-1"></a>    <span class="cf">if</span> gridlines:</span>
<span id="cb38-78"><a href="#cb38-78" tabindex="-1"></a>        plt.gca().gridlines()</span>
<span id="cb38-79"><a href="#cb38-79" tabindex="-1"></a>    </span>
<span id="cb38-80"><a href="#cb38-80" tabindex="-1"></a>    title <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss"> precipitation climatology (</span><span class="sc">{</span>season<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb38-81"><a href="#cb38-81" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb38-82"><a href="#cb38-82" tabindex="-1"></a></span>
<span id="cb38-83"><a href="#cb38-83" tabindex="-1"></a></span>
<span id="cb38-84"><a href="#cb38-84" tabindex="-1"></a><span class="kw">def</span> main(inargs):</span>
<span id="cb38-85"><a href="#cb38-85" tabindex="-1"></a>    <span class="co">"""Run the program."""</span></span>
<span id="cb38-86"><a href="#cb38-86" tabindex="-1"></a></span>
<span id="cb38-87"><a href="#cb38-87" tabindex="-1"></a>    log_lev <span class="op">=</span> logging.DEBUG <span class="cf">if</span> inargs.verbose <span class="cf">else</span> logging.WARNING</span>
<span id="cb38-88"><a href="#cb38-88" tabindex="-1"></a>    logging.basicConfig(level<span class="op">=</span>log_lev, filename<span class="op">=</span>inargs.logfile) </span>
<span id="cb38-89"><a href="#cb38-89" tabindex="-1"></a></span>
<span id="cb38-90"><a href="#cb38-90" tabindex="-1"></a>    ds <span class="op">=</span> xr.open_dataset(inargs.pr_file)</span>
<span id="cb38-91"><a href="#cb38-91" tabindex="-1"></a>    </span>
<span id="cb38-92"><a href="#cb38-92" tabindex="-1"></a>    clim <span class="op">=</span> ds[<span class="st">'pr'</span>].groupby(<span class="st">"time.season"</span>).mean(<span class="st">"time"</span>, keep_attrs<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-93"><a href="#cb38-93" tabindex="-1"></a></span>
<span id="cb38-94"><a href="#cb38-94" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb38-95"><a href="#cb38-95" tabindex="-1"></a>        input_units <span class="op">=</span> clim.attrs[<span class="st">"units"</span>]</span>
<span id="cb38-96"><a href="#cb38-96" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb38-97"><a href="#cb38-97" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">KeyError</span>(<span class="ss">f"Precipitation variable in </span><span class="sc">{</span>inargs<span class="sc">.</span>pr_file<span class="sc">}</span><span class="ss"> does not have a units attribute"</span>)</span>
<span id="cb38-98"><a href="#cb38-98" tabindex="-1"></a></span>
<span id="cb38-99"><a href="#cb38-99" tabindex="-1"></a>    <span class="cf">if</span> input_units <span class="op">==</span> <span class="st">"kg m-2 s-1"</span>:</span>
<span id="cb38-100"><a href="#cb38-100" tabindex="-1"></a>        clim <span class="op">=</span> convert_pr_units(clim)</span>
<span id="cb38-101"><a href="#cb38-101" tabindex="-1"></a>        logging.info(<span class="st">"Units converted from kg m-2 s-1 to mm/day"</span>)</span>
<span id="cb38-102"><a href="#cb38-102" tabindex="-1"></a>    <span class="cf">elif</span> input_units <span class="op">==</span> <span class="st">"mm/day"</span>:</span>
<span id="cb38-103"><a href="#cb38-103" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb38-104"><a href="#cb38-104" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb38-105"><a href="#cb38-105" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"""Input units are not 'kg m-2 s-1' or 'mm/day'"""</span>)</span>
<span id="cb38-106"><a href="#cb38-106" tabindex="-1"></a></span>
<span id="cb38-107"><a href="#cb38-107" tabindex="-1"></a>    <span class="cf">if</span> inargs.mask:</span>
<span id="cb38-108"><a href="#cb38-108" tabindex="-1"></a>        sftlf_file, realm <span class="op">=</span> inargs.mask</span>
<span id="cb38-109"><a href="#cb38-109" tabindex="-1"></a>        clim <span class="op">=</span> apply_mask(clim, sftlf_file, realm)</span>
<span id="cb38-110"><a href="#cb38-110" tabindex="-1"></a></span>
<span id="cb38-111"><a href="#cb38-111" tabindex="-1"></a>    create_plot(</span>
<span id="cb38-112"><a href="#cb38-112" tabindex="-1"></a>        clim,</span>
<span id="cb38-113"><a href="#cb38-113" tabindex="-1"></a>        ds.attrs[<span class="st">"source_id"</span>],</span>
<span id="cb38-114"><a href="#cb38-114" tabindex="-1"></a>        inargs.season,</span>
<span id="cb38-115"><a href="#cb38-115" tabindex="-1"></a>        gridlines<span class="op">=</span>inargs.gridlines,</span>
<span id="cb38-116"><a href="#cb38-116" tabindex="-1"></a>        levels<span class="op">=</span>inargs.cbar_levels</span>
<span id="cb38-117"><a href="#cb38-117" tabindex="-1"></a>    )</span>
<span id="cb38-118"><a href="#cb38-118" tabindex="-1"></a>    plt.savefig(</span>
<span id="cb38-119"><a href="#cb38-119" tabindex="-1"></a>        inargs.output_file,</span>
<span id="cb38-120"><a href="#cb38-120" tabindex="-1"></a>        dpi<span class="op">=</span><span class="dv">200</span>,</span>
<span id="cb38-121"><a href="#cb38-121" tabindex="-1"></a>        bbox_inches<span class="op">=</span><span class="st">"tight"</span>,</span>
<span id="cb38-122"><a href="#cb38-122" tabindex="-1"></a>        facecolor<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb38-123"><a href="#cb38-123" tabindex="-1"></a>    )</span>
<span id="cb38-124"><a href="#cb38-124" tabindex="-1"></a></span>
<span id="cb38-125"><a href="#cb38-125" tabindex="-1"></a></span>
<span id="cb38-126"><a href="#cb38-126" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb38-127"><a href="#cb38-127" tabindex="-1"></a>    description<span class="op">=</span><span class="st">'Plot the precipitation climatology for a given season.'</span></span>
<span id="cb38-128"><a href="#cb38-128" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser(description<span class="op">=</span>description)</span>
<span id="cb38-129"><a href="#cb38-129" tabindex="-1"></a>   </span>
<span id="cb38-130"><a href="#cb38-130" tabindex="-1"></a>    parser.add_argument(<span class="st">"pr_file"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, <span class="bu">help</span><span class="op">=</span><span class="st">"Precipitation data file"</span>)</span>
<span id="cb38-131"><a href="#cb38-131" tabindex="-1"></a>    parser.add_argument(<span class="st">"season"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, <span class="bu">help</span><span class="op">=</span><span class="st">"Season to plot"</span>)</span>
<span id="cb38-132"><a href="#cb38-132" tabindex="-1"></a>    parser.add_argument(<span class="st">"output_file"</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, <span class="bu">help</span><span class="op">=</span><span class="st">"Output file name"</span>)</span>
<span id="cb38-133"><a href="#cb38-133" tabindex="-1"></a></span>
<span id="cb38-134"><a href="#cb38-134" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb38-135"><a href="#cb38-135" tabindex="-1"></a>        <span class="st">"--gridlines"</span>,</span>
<span id="cb38-136"><a href="#cb38-136" tabindex="-1"></a>        action<span class="op">=</span><span class="st">"store_true"</span>,</span>
<span id="cb38-137"><a href="#cb38-137" tabindex="-1"></a>        default<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb38-138"><a href="#cb38-138" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Include gridlines on the plot"</span>,</span>
<span id="cb38-139"><a href="#cb38-139" tabindex="-1"></a>    )</span>
<span id="cb38-140"><a href="#cb38-140" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb38-141"><a href="#cb38-141" tabindex="-1"></a>        <span class="st">"--cbar_levels"</span>,</span>
<span id="cb38-142"><a href="#cb38-142" tabindex="-1"></a>        <span class="bu">type</span><span class="op">=</span><span class="bu">float</span>,</span>
<span id="cb38-143"><a href="#cb38-143" tabindex="-1"></a>        nargs<span class="op">=</span><span class="st">"*"</span>,</span>
<span id="cb38-144"><a href="#cb38-144" tabindex="-1"></a>        default<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb38-145"><a href="#cb38-145" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"list of levels / tick marks to appear on the colorbar"</span>,</span>
<span id="cb38-146"><a href="#cb38-146" tabindex="-1"></a>    )</span>
<span id="cb38-147"><a href="#cb38-147" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb38-148"><a href="#cb38-148" tabindex="-1"></a>        <span class="st">"--mask"</span>,</span>
<span id="cb38-149"><a href="#cb38-149" tabindex="-1"></a>        <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>,</span>
<span id="cb38-150"><a href="#cb38-150" tabindex="-1"></a>        nargs<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb38-151"><a href="#cb38-151" tabindex="-1"></a>        metavar<span class="op">=</span>(<span class="st">"SFTLF_FILE"</span>, <span class="st">"REALM"</span>),</span>
<span id="cb38-152"><a href="#cb38-152" tabindex="-1"></a>        default<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb38-153"><a href="#cb38-153" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"""Provide sftlf file and realm to mask ('land' or 'ocean')"""</span>,</span>
<span id="cb38-154"><a href="#cb38-154" tabindex="-1"></a>    )</span>
<span id="cb38-155"><a href="#cb38-155" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb38-156"><a href="#cb38-156" tabindex="-1"></a>        <span class="st">"-v"</span>,</span>
<span id="cb38-157"><a href="#cb38-157" tabindex="-1"></a>        <span class="st">"--verbose"</span>,</span>
<span id="cb38-158"><a href="#cb38-158" tabindex="-1"></a>        action<span class="op">=</span><span class="st">"store_true"</span>,</span>
<span id="cb38-159"><a href="#cb38-159" tabindex="-1"></a>        default<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb38-160"><a href="#cb38-160" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Change the minimum logging reporting level from WARNING (default) to DEBUG"</span>,</span>
<span id="cb38-161"><a href="#cb38-161" tabindex="-1"></a>    )</span>
<span id="cb38-162"><a href="#cb38-162" tabindex="-1"></a>    parser.add_argument(</span>
<span id="cb38-163"><a href="#cb38-163" tabindex="-1"></a>        <span class="st">"--logfile"</span>,</span>
<span id="cb38-164"><a href="#cb38-164" tabindex="-1"></a>        <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>,</span>
<span id="cb38-165"><a href="#cb38-165" tabindex="-1"></a>        default<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb38-166"><a href="#cb38-166" tabindex="-1"></a>        <span class="bu">help</span><span class="op">=</span><span class="st">"Name of log file (by default logging information is printed to the screen)"</span>,</span>
<span id="cb38-167"><a href="#cb38-167" tabindex="-1"></a>    )</span>
<span id="cb38-168"><a href="#cb38-168" tabindex="-1"></a></span>
<span id="cb38-169"><a href="#cb38-169" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb38-170"><a href="#cb38-170" tabindex="-1"></a>    main(args)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Program defensively, i.e., assume that errors are going to arise,
and write code to detect them when they do.</li>
<li>You can raise exceptions in your own code.</li>
<li>Put try-except blocks in programs to catch and handle
exceptions.</li>
<li>Put assertions in programs to check their state as they run.</li>
<li>Use a logging framework instead of <code>print</code> statements to
report program activity.</li>
<li>The are more advanced lessons you can read to learn about code
testing.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="07-vectorisation.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="09-provenance.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="07-vectorisation.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Vectorisation
        </a>
        <a class="chapter-link float-end" href="09-provenance.html" rel="next">
          Next: Data provenance...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/fishtree-attempt/python-aos-lesson/edit/main/episodes/08-defensive.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/fishtree-attempt/python-aos-lesson/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/fishtree-attempt/python-aos-lesson/" class="external-link">Source</a></p>
				<p><a href="https://github.com/fishtree-attempt/python-aos-lesson/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:irving.damien@gmail.com">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.5" class="external-link">sandpaper (0.16.5)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.3" class="external-link">varnish (1.0.3)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://fishtree-attempt.github.io/python-aos-lesson/08-defensive.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Defensive programming",
  "creativeWorkStatus": "active",
  "url": "https://fishtree-attempt.github.io/python-aos-lesson/08-defensive.html",
  "identifier": "https://fishtree-attempt.github.io/python-aos-lesson/08-defensive.html",
  "dateCreated": "2018-01-15",
  "dateModified": "2024-07-25",
  "datePublished": "2024-07-25"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

